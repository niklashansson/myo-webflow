{
  "version": 3,
  "sources": ["../../bin/live-reload.js", "../../node_modules/.pnpm/delay@6.0.0/node_modules/delay/index.js", "../../src/analytics/subscription.ts"],
  "sourcesContent": ["new EventSource(`${SERVE_ORIGIN}/esbuild`).addEventListener('change', () => location.reload());\n", "// From https://github.com/sindresorhus/random-int/blob/c37741b56f76b9160b0b63dae4e9c64875128146/index.js#L13-L15\nconst randomInteger = (minimum, maximum) => Math.floor((Math.random() * (maximum - minimum + 1)) + minimum);\n\nconst createAbortError = () => {\n\tconst error = new Error('Delay aborted');\n\terror.name = 'AbortError';\n\treturn error;\n};\n\nconst clearMethods = new WeakMap();\n\nexport function createDelay({clearTimeout: defaultClear, setTimeout: defaultSet} = {}) {\n\t// We cannot use `async` here as we need the promise identity.\n\treturn (milliseconds, {value, signal} = {}) => {\n\t\t// TODO: Use `signal?.throwIfAborted()` when targeting Node.js 18.\n\t\tif (signal?.aborted) {\n\t\t\treturn Promise.reject(createAbortError());\n\t\t}\n\n\t\tlet timeoutId;\n\t\tlet settle;\n\t\tlet rejectFunction;\n\t\tconst clear = defaultClear ?? clearTimeout;\n\n\t\tconst signalListener = () => {\n\t\t\tclear(timeoutId);\n\t\t\trejectFunction(createAbortError());\n\t\t};\n\n\t\tconst cleanup = () => {\n\t\t\tif (signal) {\n\t\t\t\tsignal.removeEventListener('abort', signalListener);\n\t\t\t}\n\t\t};\n\n\t\tconst delayPromise = new Promise((resolve, reject) => {\n\t\t\tsettle = () => {\n\t\t\t\tcleanup();\n\t\t\t\tresolve(value);\n\t\t\t};\n\n\t\t\trejectFunction = reject;\n\t\t\ttimeoutId = (defaultSet ?? setTimeout)(settle, milliseconds);\n\t\t});\n\n\t\tif (signal) {\n\t\t\tsignal.addEventListener('abort', signalListener, {once: true});\n\t\t}\n\n\t\tclearMethods.set(delayPromise, () => {\n\t\t\tclear(timeoutId);\n\t\t\ttimeoutId = null;\n\t\t\tsettle();\n\t\t});\n\n\t\treturn delayPromise;\n\t};\n}\n\nconst delay = createDelay();\n\nexport default delay;\n\nexport async function rangeDelay(minimum, maximum, options = {}) {\n\treturn delay(randomInteger(minimum, maximum), options);\n}\n\nexport function clearDelay(promise) {\n\tclearMethods.get(promise)?.();\n}\n", "/* eslint-disable @typescript-eslint/no-explicit-any */\nimport type { GetCurrentMemberPayload } from '@memberstack/dom';\nimport delay from 'delay';\n\nwindow.addEventListener('load', init);\n\nasync function init() {\n  await delay(1000);\n  const { priceId, isFromCheckout } = parseUrl();\n  if (!priceId || !isFromCheckout) {\n    redirect();\n    return;\n  }\n\n  const memberData = getMemberData() as GetCurrentMemberPayload['data'] | undefined;\n  if (!memberData) return redirect();\n\n  const successPlan = memberData.planConnections.find(\n    (plan) =>\n      plan.active &&\n      plan.payment?.priceId === priceId &&\n      plan.payment.status === 'PAID' &&\n      !plan.payment.cancelAtDate\n  );\n\n  if (!successPlan) return redirect();\n\n  pushToDataLayer(memberData, successPlan.planId);\n}\n\n// function verifyPlan(timestamp: string) {\n//   const currentTimestamp = Math.floor(Date.now() / 1000); // Current timestamp in seconds\n//   return currentTimestamp - Number(timestamp) < 0.5 * 60;\n// }\n\nfunction redirect() {\n  window.location.href = '/';\n}\n\nfunction parseUrl() {\n  const url = new URL(window.location.href);\n\n  const isFromCheckout = url.searchParams.get('fromCheckout');\n  const priceId = url.searchParams.get('msPriceId');\n  return {\n    priceId,\n    isFromCheckout,\n  };\n}\n\nfunction getMemberData() {\n  const data = localStorage.getItem('_ms-mem');\n  return data ? JSON.parse(data) : undefined;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars, @typescript-eslint/no-explicit-any\nfunction pushToDataLayer(\n  memberData: GetCurrentMemberPayload['data'] & {\n    customFields: { ['first-name']?: string; ['last-name']?: string; ['location']?: string };\n  },\n  planId: string\n) {\n  const event = {\n    event: 'myo-new-subscription',\n    newInstructionsSubscription: {\n      memberEmail: memberData.auth.email,\n      memberId: memberData.id,\n      memberFirstName: memberData.customFields['first-name'],\n      memberLastName: memberData.customFields['last-name'],\n      memberLocation: memberData.customFields?.location,\n      stripeCustomerId: memberData.stripeCustomerId,\n      planId,\n    },\n    data: memberData,\n  };\n  // @ts-expect-error \"data layer\"\n  window.dataLayer.push(event);\n\n  return event;\n}\n"],
  "mappings": "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",
  "names": []
}
